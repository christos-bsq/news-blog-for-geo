---
import type { CollectionEntry } from "astro:content";
import { getCollection } from "astro:content";
import BaseLayout from "@/layouts/BaseLayout.astro";
import PostCard from "@/components/PostCard.astro";
import { sortPosts } from "@/lib/postHelpers";

export async function getStaticPaths() {
  const allPosts = await getCollection("posts");
  const uniqueTags = [...new Set(allPosts.map((post) => post.data.tags).flat())];

  return uniqueTags.map((tag) => {
    const filtered = allPosts.filter((post) => post.data.tags?.includes(tag));
    return {
      params: { tag },
      props: {
        tag,
        posts: sortPosts(filtered),
      },
    };
  });
}

const { tag, posts } = Astro.props as {
  tag: string;
  posts: CollectionEntry<"posts">[];
};
---

<BaseLayout title={`#${tag} | Signal North Daily`} description={`Articles filed under #${tag}.`}>
  <section class="space-y-4">
    <h1 class="text-4xl font-semibold text-base-900">#{tag}</h1>
    <p class="text-base text-base-600">{posts.length} posts mention this tag.</p>
  </section>
  <div class="mt-8 grid gap-6 md:grid-cols-2">
    {posts.map((post) => (
      <PostCard post={post} />
    ))}
  </div>
</BaseLayout>
