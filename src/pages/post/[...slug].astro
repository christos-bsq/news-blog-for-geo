---
import type { CollectionEntry } from 'astro:content'
import { getCollection } from 'astro:content'
import { marked } from 'marked'
import BlogPost from '@/layouts/BlogPost'
import { getPostSlug } from '@/utils'

export async function getStaticPaths() {
	const posts = await getCollection('posts')
	return posts.map((post) => ({
		params: { slug: getPostSlug(post) },
		props: { post }
	}))
}

interface Props {
	post: CollectionEntry<'posts'>
}

const { post } = Astro.props as Props
const { Content, headings, remarkPluginFrontmatter } = await post.render()
const htmlForClient = marked.parse(post.body.replace(/^---[\s\S]*?---/, ''))
const readTime = remarkPluginFrontmatter?.minutesRead ?? ''
---

<BlogPost
	post={post}
	Content={Content}
	headings={headings}
	readTime={readTime}
	htmlForClient={htmlForClient}
/>
